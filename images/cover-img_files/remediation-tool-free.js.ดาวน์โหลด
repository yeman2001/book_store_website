var Ye=Object.defineProperty;var yt=Object.getOwnPropertySymbols;var tn=Object.prototype.hasOwnProperty,en=Object.prototype.propertyIsEnumerable;var _t=(p,m,u)=>m in p?Ye(p,m,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[m]=u,St=(p,m)=>{for(var u in m||(m={}))tn.call(m,u)&&_t(p,u,m[u]);if(yt)for(var u of yt(m))en.call(m,u)&&_t(p,u,m[u]);return p};var S=(p,m,u)=>new Promise((T,v)=>{var O=f=>{try{b(u.next(f))}catch(N){v(N)}},D=f=>{try{b(u.throw(f))}catch(N){v(N)}},b=f=>f.done?T(f.value):Promise.resolve(f.value).then(O,D);b((u=u.apply(p,m)).next())});(function(){"use strict";const p=t=>S(this,null,function*(){return yield(yield fetch(t)).json()}),m={AriaEditorValues:[],BrokenLink:[],Contrast:[],EmptyControls:[],ExternalLink:[],Forms:[],Headings:[],Language:[],MissingAlts:[],Pdfs:[],VagueLinks:[]},u=UserWayWidgetApp.ContextHolder.config.remediation,T=UserWayWidgetApp.ContextHolder.config.tunings,v=UserWayWidgetApp.ContextHolder.config.services,O=UserWayWidgetApp.ContextHolder.config.imageAlt;function D(t){St({},t)}const b=()=>S(this,null,function*(){if(u!=null&&u.consolidated){const t=yield p(u.consolidated);t.MissingAlts.reverse(),D(t);return}D(m)}),f=["script","noscript","style","path","circle","rect","ellipse","line","polygon","polyline","g"],K=["data-uw-ignore","data-uw-rm-ignore"],q=()=>{const t=f.join(","),e=K.map(o=>`[${o}]`).join(","),n=`${t},${e}`;return document.body.querySelectorAll(`*:not(${n})`)};var Tt=typeof global=="object"&&global&&global.Object===Object&&global;const vt=Tt;var Ot=typeof self=="object"&&self&&self.Object===Object&&self,Mt=vt||Ot||Function("return this")();const J=Mt;var Ct=J.Symbol;const x=Ct;var Q=Object.prototype,wt=Q.hasOwnProperty,Dt=Q.toString,M=x?x.toStringTag:void 0;function Nt(t){var e=wt.call(t,M),n=t[M];try{t[M]=void 0;var o=!0}catch(i){}var r=Dt.call(t);return o&&(e?t[M]=n:delete t[M]),r}var xt=Object.prototype,Lt=xt.toString;function Wt(t){return Lt.call(t)}var Ut="[object Null]",kt="[object Undefined]",Y=x?x.toStringTag:void 0;function jt(t){return t==null?t===void 0?kt:Ut:Y&&Y in Object(t)?Nt(t):Wt(t)}function Gt(t){return t!=null&&typeof t=="object"}var Bt="[object Symbol]";function Ft(t){return typeof t=="symbol"||Gt(t)&&jt(t)==Bt}var Pt=/\s/;function $t(t){for(var e=t.length;e--&&Pt.test(t.charAt(e)););return e}var Ht=/^\s+/;function Xt(t){return t&&t.slice(0,$t(t)+1).replace(Ht,"")}function L(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var tt=0/0,zt=/^[-+]0x[0-9a-f]+$/i,Zt=/^0b[01]+$/i,Vt=/^0o[0-7]+$/i,Kt=parseInt;function et(t){if(typeof t=="number")return t;if(Ft(t))return tt;if(L(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=L(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Xt(t);var n=Zt.test(t);return n||Vt.test(t)?Kt(t.slice(2),n?2:8):zt.test(t)?tt:+t}var qt=function(){return J.Date.now()};const B=qt;var Jt="Expected a function",Qt=Math.max,Yt=Math.min;function F(t,e,n){var o,r,i,s,a,c,l=0,d=!1,h=!1,_=!0;if(typeof t!="function")throw new TypeError(Jt);e=et(e)||0,L(n)&&(d=!!n.leading,h="maxWait"in n,i=h?Qt(et(n.maxWait)||0,e):i,_="trailing"in n?!!n.trailing:_);function C(g){var I=o,w=r;return o=r=void 0,l=g,s=t.apply(w,I),s}function Ke(g){return l=g,a=setTimeout(G,e),d?C(g):s}function qe(g){var I=g-c,w=g-l,Rt=e-I;return h?Yt(Rt,i-w):Rt}function It(g){var I=g-c,w=g-l;return c===void 0||I>=e||I<0||h&&w>=i}function G(){var g=B();if(It(g))return bt(g);a=setTimeout(G,qe(g))}function bt(g){return a=void 0,_&&o?C(g):(o=r=void 0,s)}function Je(){a!==void 0&&clearTimeout(a),l=0,o=c=r=a=void 0}function Qe(){return a===void 0?s:bt(B())}function V(){var g=B(),I=It(g);if(o=arguments,r=this,c=g,I){if(a===void 0)return Ke(c);if(h)return clearTimeout(a),a=setTimeout(G,e),C(c)}return a===void 0&&(a=setTimeout(G,e)),s}return V.cancel=Je,V.flush=Qe,V}var te="Expected a function";function ee(t,e,n){var o=!0,r=!0;if(typeof t!="function")throw new TypeError(te);return L(n)&&(o="leading"in n?!!n.leading:o,r="trailing"in n?!!n.trailing:r),F(t,e,{leading:o,maxWait:e,trailing:r})}const ne=300,re=500,oe=2e3,ie=2e3,se=500;let nt=!0;const ae=t=>{setTimeout(()=>{nt=!1},ie);const e=ee(r=>t(r),ne,{leading:!0,trailing:!0}),n=F(r=>t(r),re,{maxWait:oe,leading:!0,trailing:!0});return{run:r=>nt?e(r):n(r)}},ce="https://cdn.userway.org/";var W=(t=>(t.Remediation="remediation",t.AriaEditor="aria-editor",t))(W||{}),P=(t=>(t.KeyboardNavEnabled="app-key-nav-enabled",t))(P||{});const rt=(t,e)=>{const n=r=>{const{data:i}=r,{isUserWay:s,action:a,type:c}=i;!s||a!==W.Remediation||c!==t||e()};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},ot=(()=>{let t=!1,e=[],n=[];const o=a=>{t||(t=!0,e.forEach(c=>{c.run(a)}),t=!1,n=[])},{run:r}=ae(o);return{run:r,init:()=>S(this,null,function*(){if(e=(yield Promise.resolve().then(()=>Ve)).RulesList,!T.tech_rem_on_tab){const l=q();r([...l])}const c=rt(P.KeyboardNavEnabled,()=>{const l=q();r([...l]),c()})}),onDomUpdates:a=>{n.push(...a),r(n)}}})(),it=t=>!(t instanceof HTMLElement)||K.some(e=>t.hasAttribute(e))||f.includes(t.nodeName.toLowerCase()),ue=(t,e)=>e==="childList"?[].filter.call(t.addedNodes,n=>!it(n)):e==="attributes"?it(t.target)?[]:[t.target]:[],le=t=>{const e=[];for(const n of t)e.push(...ue(n,n.type));return e},ge=["aria-label","alt"],de=document.body,me={attributes:!0,attributeFilter:ge,childList:!0,subtree:!0},st=new MutationObserver(t=>{const e=le(t);e.length&&ot.onDomUpdates(e)}),pe=(t=de,e=me)=>{T.tech_rem_on_tab||st.observe(t,e);const n=rt(P.KeyboardNavEnabled,()=>{st.observe(t,e),n()})};(()=>S(this,null,function*(){var e;yield b();const t=(e=T.tech_rem_in_throttle_ms)!=null?e:se;setTimeout(()=>{ot.init(),pe()},t)}))();const fe=({ruleId:t,isTargetElement:e,rule:n,postMessageApi:o})=>{const r=i=>!i.hasAttribute(`uw-ignore-${t}`);return o&&window.addEventListener("message",i=>{const{data:s}=i,{isUserWay:a,action:c,type:l}=s;!a||c!==W.Remediation&&c!==W.AriaEditor||o[l]&&o[l](s.data?s.data:s)}),{run:i=>{if(!e){n({context:{elements:i}});return}const s=i.filter(a=>r(a)&&e(a));s.length&&n({context:{elements:s}})},stop:()=>{},rerun:()=>{},ruleId:t}},Ee=new RegExp("^(data:)"),Ae=new RegExp("(.)(gif|jpe?g|tiff?|png|webp|bmp)","i"),U=t=>{if(Ee.test(t))return t;t&&(t=t.replace(/^(http|https)(:\/\/)/,"").replace(/^(www\.)/,""));const e=t.match(Ae);return e!=null&&e.index&&(e!=null&&e.length)?t.substring(0,e.index+e[0].length):t.split("?")[0]},he=t=>{try{const e=new URL(t);return e.search="",e.toString()}catch(e){return t}},Ie={automaticcoupons:/automaticcoupons/,"shopping.yahoo":/shopping\.yahoo/,shopperapproved:/shopperapproved/,rakuten:/rakuten/,"translate.google":/translate\.google/,"maps.googleapis.com":/maps\.googleapis\.com/,"s.w.org":/s\.w\.org/,avatar:/avatar/,companylogos:/companylogos/,favicon:/favicon/,activecampaign:/lt\.php(.*)?l=open/,aweber:/openrate\.aweber\.com/,bananatag:/bl-1\.com/,boomerang:/mailstat\.us\/tr/,"campaign monitor":/cmail(\d+)\.com\/t\//,"cirrus insight":/tracking\.cirrusinsight\.com/,close:/close\.com\/email_opened/,"constant contact":/rs6\.net\/on\.jsp/,contactmonkey:/contactmonkey\.com\/api\/v1\/tracker/,convertkit:/convertkit-mail\.com\/o/,"critical impact":/portal\.criticalimpact\.com\/c2\//,emarsys:/emarsys\.com\/e2t\/o/,gem:/zen\.sr\/o/,getnotify:/email81\.com\/case/,getresponse:/getresponse\.com\/open\.html/,growthdot:/growthdot\.com\/api\/mail-tracking/,front:/app\.frontapp\.com\/(.*)?\/seen/,hubspot:/t\.(hubspotemail|hubspotfree|signaux|senal|sidekickopen|sigopn)/,icontact:/click\.icptrack\.com\/icp/,intercom:/(via\.intercom\.io\/o)|(intercom-mail\.com\/via\/o)/,litmus:/emltrk\.com/,mailchimp:/list-manage\.com\/track/,mailgun:/email\.(mailgun|mg)(.*)?\/o/,mailjet:/mjt\.lu\/oo/,mailspring:/getmailspring\.com\/open/,mailtrack:/(mailtrack\.io\/trace)|(mltrk\.io\/pixel)/,mandrill:/mandrillapp\.com\/track/,marketo:/resources\.marketo\.com\/trk/,mixmax:/(email|track)\.mixmax\.com/,mixpanel:/api\.mixpanel\.com\/track/,nethunt:/nethunt\.co(.*)?\/pixel\.gif/,newton:/tr\.cloudmagic\.com/,outreach:/api\/mailings\/opened/,phplist:/phplist\.com\/lists\/ut\.php/,polymail:/polymail\.io/,postmark:/pstmrk\.it\/open/,"return path":/returnpath\.net\/pixel\.gif/,sailthru:/sailthru\.com\/trk/,salesforce:/nova\.collect\.igodigital\.com/,sendgrid:/wf\/open\?upn/,sendy:/sendy\/t\//,streak:/mailfoogae\.appspot\.com/,superhuman:/r\.superhuman\.com/,thunderhead:/na5\.thunderhead\.com/,tinyletter:/tinyletterapp\.com.*open\.gif/,yamm:/yamm-track\.appspot/,yesware:/t\.yesware\.com/,"zendesk sell":/futuresimple\.com\/api\/v1\/sprite\.png/},at=new RegExp("^(data:)"),ct=new RegExp(/^.+\.svg$/),be=50,$=10,Re=5,ut=10,ye=255;var A=(t=>(t.EXCLUDED_SRC="EXCLUDED_SRC",t.HIDDEN_FROM_SCREEN_READER="HIDDEN_FROM_SCREEN_READER",t.BASE64="BASE64",t.SVG="SVG",t.SMALL_SIZE="SMALL_SIZE",t.MICRO_SIZE="MICRO_SIZE",t.WRONG_SRC="WRONG_SRC",t.ASPECT_RATIO="ASPECT_RATIO",t))(A||{});const lt=["SVG","SMALL_SIZE","HIDDEN_FROM_SCREEN_READER"],k="data-uw-rm-alt-original",gt="REMEDIATION_IMAGE_MISSING_ALT",R="data-uw-rm-alt",_e=1e3,Se=2e3,dt=["jpg","jpeg","png","gif","bmp","tiff","tif","svg","webp","ico","apng","heif","heic","avif","eps","raw","cr2","nef","orf","sr2"],Te=t=>{const e=t.tagName.toLowerCase()==="img",n=t.hasAttribute(R);if(!e||n)return!1;const o=t.getAttribute("src"),r=t.getAttribute("srcset");return!!(o!=null?o:r)||!!t.closest("picture")},E=({currentSrc:t,src:e})=>t||e,H=(t,e)=>{try{const{width:o,height:r}=window.getComputedStyle(t);return parseInt(o,10)>e&&parseInt(r,10)>e}catch(o){return!1}},y=(t,{decorative:e,approved:n,fixedByUserWay:o,loadingFromMS:r})=>{var i;return{src:E(t),alt:t.alt,originalAlt:(i=t.getAttribute(k))!=null?i:"",decorative:e,approved:n,fixedByUserWay:o,loadingFromMS:r}},X=t=>{t.setAttribute("role","presentation"),t.removeAttribute("aria-hidden"),t.setAttribute("alt","")},mt=t=>{if(!t)return"";const{hostname:e}=new URL(t);return e.replace(/^https?:\/\//,"").replace(/^www\./,"").replace(/\.[a-zA-Z0-9]*$/,"")},ve=t=>{const e=[];return t.forEach(o=>{const r=E(o),i=mt(r);if(i){let s=e.find(a=>a.name===i);s||(s={name:i,weight:0},e.push(s)),s.weight+=1}}),e.sort((o,r)=>o.weight<r.weight?1:-1)[0].name},Oe=(t,e)=>{const n=E(t);return mt(n)!==e&&!H(t,$)},j=t=>{const n=new RegExp(`\\.(${dt.join("|")})$`,"i").test(t),o=t.length>ye,r=!t.trim(),i=/[0-9]{5,}/.test(t),a=new RegExp(/^[!@#$%^&*()_+{}[\]`:;<>,.?~\\|\-="'/]+$/,"u").test(t);return i||n||o||r||a},Me=(t,e)=>{const n=e.alt.trim(),o=E(e),r=t.find(C=>U(C.src)===U(o));if(!r||r.alt===null)return null;const{decorative:i,alt:s,approved:a,reverted:c}=r;if(c)return e.setAttribute(R,"true"),y(e,{approved:!0,decorative:!n,fixedByUserWay:!1});const d=!(!u||u.strategy==="AUTO")&&!a;i&&!d&&X(e);const h=a||!n||j(n);s&&!d&&h&&!i&&e.setAttribute("alt",s),e.setAttribute(R,"true");const _=y(e,{approved:a,decorative:i,fixedByUserWay:!0});return d&&(_.alt=s),_},Ce=t=>{if(typeof t!="string")return!1;for(const e of Object.values(Ie)){const n=new RegExp(e,"i");if(t.match(n))return!0}return!1},we=t=>t?t.match(at)?!1:!new RegExp(`^https?://.{1,256}\\.[a-z]{2,6}/.*\\.(${dt.join("|")})(\\?.*)?$`,"i").test(t):!0,De=t=>{try{const{width:n,height:o}=window.getComputedStyle(t),r=parseInt(n,10),i=parseInt(o,10),s=r<=$&&i>=r*ut,a=i<=$&&r>=i*ut;return!!(s||a)}catch(n){return!1}},z=t=>{const e=E(t),n=j(t.alt);return we(e)?A.WRONG_SRC:Ce(e)?A.EXCLUDED_SRC:H(t,Re)?De(t)?A.ASPECT_RATIO:at.test(e)?A.BASE64:t.getAttribute("aria-hidden")==="true"||t.getAttribute("role")==="presentation"||t.getAttribute("role")==="none"?A.HIDDEN_FROM_SCREEN_READER:ct.test(e)&&n?A.SVG:!H(t,be)&&n?A.SMALL_SIZE:null:A.MICRO_SIZE},Ne=(t,e,n,o)=>{const r=UserWayWidgetApp.getLib("remediation_manager"),i=UserWayWidgetApp.getLib("remediation_helper_outcome");if(!i.of)return;const s=i.of(t,{items:e},null,n,o);r.HelperCallbackAggregator.onHelperRemediationCompleted(s)},pt=t=>Ne(gt,t,t.filter(e=>e.fixedByUserWay).length,t.filter(e=>!e.approved).length),xe=t=>{t.hasAttribute(k)||t.setAttribute(k,t.alt)},ft=(t,e=[])=>{var r;if(t.length===0)return;const{paidAi:n}=v,o=[];for(const i of t){const s=i,a=j(s.alt),c=E(s);xe(s),ct.test(c)&&n&&s.setAttribute("role","img");const l=Me(e,s);if(l){o.push(l);continue}if(!n)continue;const d=z(s);if(!a&&!d){s.setAttribute(R,"true"),o.push(y(s,{approved:!0,decorative:!1,fixedByUserWay:!1}));continue}if(d!==null||(r=u.alt)!=null&&r.quotaExceeded){X(s),s.setAttribute(R,"true"),d&&lt.includes(d)&&o.push(y(s,{approved:!1,decorative:!0,fixedByUserWay:!0}));continue}s.setAttribute(R,"true"),o.push(y(s,{approved:!1,decorative:!1,fixedByUserWay:!0,loadingFromMS:!0}))}pt(o)},Et=t=>{const e=t.replace(/^https?:\/\//,"");return document.querySelectorAll(`img[src*="${e}" i],img[srcset*="${e}" i]`)},Le=({src:t})=>{const e=Et(t);for(const n of e){const o=n.getAttribute(k);o!==null&&n.setAttribute("alt",o)}},We=({src:t,decorative:e,alt:n,role:o})=>{const r=Et(t);if(r.length){for(const i of r)i.setAttribute("alt",n!=null?n:""),e?X(i):((i.getAttribute("role")==="presentation"||i.getAttribute("role")==="none")&&i.removeAttribute("role"),i.hasAttribute("aria-hidden")&&i.removeAttribute("aria-hidden")),["link","button","heading"].includes(o)&&i.setAttribute("aria-label",n);pt([y(r[0],{approved:!0,decorative:e,fixedByUserWay:!1})])}},Ue=()=>{b()},ke=t=>S(this,null,function*(){const{account:e}=UserWayWidgetApp.ContextHolder.config,{siteId:n}=v,{resourceHash:o}=O,r=encodeURIComponent(t);return(yield(yield fetch(`${ce}api/img-dscr/v2/${e}/${n}/${o}/alts.json?dto=${r}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()).payload});var At=(t=>(t.RO="RO",t))(At||{});const je=(t,e)=>t.src.localeCompare(e.src),Ge=t=>{const e=t,n=e.filter((o,r)=>r===e.findIndex(i=>E(o)===E(i))).map(o=>{const r=o,i=r.alt.trim(),s=i&&!j(i),a=E(r);return{src:he(a),alt:r.alt.trim(),dir:s||z(r)?At.RO:void 0}});return n.sort(je),n},Be=(t,e)=>{const n=Math.ceil(t.length/e),o=[];for(let r=0;r<t.length;r+=n)o.push(t.slice(r,r+n));return o},Fe=t=>encodeURIComponent(t).length/1024,Pe=8,$e=12,ht=(t,e=1)=>{if(e>=$e)throw new Error("Max split level exceed");const n=Be(t,e),o=[];for(const r of n){const i={sorted:r,tier:O.tier},s=JSON.stringify(i);if(Fe(s)>Pe)return ht(t,e+1);o.push(s)}return o},Z=[],He=()=>{Z.length=0},Xe=t=>{const{state:e}=O;if(e==="ALTS_OFF")return;const n=ve(t),o=[],r=[];for(const i of t){const s=i,a=Oe(s,n),c=z(s);c&&!lt.includes(c)||a?r.push(s):o.push(s)}try{const i=Ge(o),s=ht(i);for(const a of s)ke(a).then(({missingAlts:c})=>{const l=o.filter(d=>c.find(h=>U(h.src)===U(E(d))));ft(l,c)})}catch(i){console.error(i)}ft(r),He()},ze=F(t=>Xe(t),_e,{maxWait:Se,leading:!0,trailing:!0}),Ze=[fe({ruleId:gt,rule:({context:{elements:t}})=>{Z.push(...t),ze(Z)},isTargetElement:Te,postMessageApi:{"image-alt-update":We,"image-alt-revert":Le,"image-alt-update-config":Ue}})],Ve=Object.freeze(Object.defineProperty({__proto__:null,RulesList:Ze},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=remediation-tool-free.js.map
